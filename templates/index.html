<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>è‚²è‹—ç®± æ¸©åº¦ãƒ»LEDç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        body {
            background-color: seagreen;
        }
        /* å…¨ä½“ã‚«ãƒ¼ãƒ‰ */
        .card {
            background: #f0fff8;
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            width: 90%;
            max-width: 400px;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
            font-family: Arial, sans-serif;
        }
        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .card h1 {
            text-align: center;
            margin: 20px;
            font-size: 1.8rem;
        }
        /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦‹å‡ºã— */
        .card h2 {
            margin: 10px 0px;
            text-align: center;
            font-size: 1.2rem;
        }
        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹éƒ¨åˆ†ã®è¡Œ */
        .status-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
        }
        /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦‹å‡ºã— */
        .card h2 {
            margin: 10px 0px;
            text-align: center;
        }
        /* ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ CSS */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        .switch input { 
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 23px;
            width: 23px;
            left: 5px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: seagreen;
        }
        input:checked + .slider:before {
            transform: translateX(28px);
        }
        /* ãƒ•ã‚©ãƒ¼ãƒ ã®è¡Œ */
        .form-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        /* åˆ¶å¾¡ã‚¹ã‚¤ãƒƒãƒå°‚ç”¨ï¼ˆãƒ©ãƒ™ãƒ«ã¯ä¸Šæ®µã€ã‚¹ã‚¤ãƒƒãƒã¯ä¸‹æ®µï¼‰ */
        .block-container {
            display: block;
            margin-top: 5px;
        }
        .form-group {
            flex: 1;
            margin-right: 10px;
        }
        .form-group:last-child {
            margin-right: 0;
        }
        .labeled-value {
            flex: 1;
            margin-right: 10px;
            text-align: center;
        }
        label {
            margin-bottom: 5px;
        }
        input[type="number"] {
            width: 4em;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ced4da;
        }
        input[type="time"] {
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ced4da;
        }
        /* ãƒœã‚¿ãƒ³ */
        button {
            padding: 10px 15px;
            background-color: #2196F3;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        button {
            background: seagreen;
            color: white;
        }
        button:hover {
            background: lightseagreen;
        }
        #reset-btn {
            background: slategray;
            color: white;
        }
        #reset-btn:hover {
            background: silver;
        }
        .button-group {
            display: flex;
            align-items: center;
        }
    </style>
    <script>
        const URL_API_BASE = "http://{{server_ip}}:5000/api";

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å–å¾—ã¨ãƒ•ã‚©ãƒ¼ãƒ ã¸è¨­å®šå€¤ã®ãƒ­ãƒ¼ãƒ‰
        window.onload = function() {
            updateStatus();
            loadConfigIntoForm();
        };

        // /statusã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã€ä¸Šéƒ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ¼ãƒ‰ã«åæ˜ 
        function updateStatus() {
            fetch(URL_API_BASE + '/status')
                .then(response => response.json())
                .then(data => {
                    // æ¸©åº¦è¡¨ç¤ºã«æ˜¼å¤œæƒ…å ±ã‚’ä»˜åŠ ã—ã€temp_statusã«å¿œã˜ãŸè‰²ã‚’è¨­å®š
                    var tempElem = document.getElementById('currentTemp');
                    tempElem.innerText = data.temperature + " Â°C";
                    if (data.temp_status === "low") {
                        tempElem.style.color = "blue";
                    } else if (data.temp_status === "high") {
                        tempElem.style.color = "red";
                    } else {
                        tempElem.style.color = "black";
                    }
                    document.getElementById('tempStatus').innerText = data.time_of_day ? "æ˜¼" : "å¤œ";
                    document.getElementById('heaterStatus').innerText = data.heater ? "ON" : "OFF";
                    document.getElementById('ledStatus').innerText = data.led ? "ON" : "OFF";
                })
                .catch(error => console.error('Error:', error));
        }

        // /statusã‹ã‚‰å–å¾—ã—ãŸè¨­å®šå€¤ã‚’è¨­å®šãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜ 
        function loadConfigIntoForm() {
            fetch(URL_API_BASE + '/status')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('inputDayStart').value = data.day_start;
                    document.getElementById('inputDayEnd').value = data.day_end;
                    document.getElementById('inputDayMin').value = data.day_min;
                    document.getElementById('inputDayMax').value = data.day_max;
                    document.getElementById('inputNightMin').value = data.night_min;
                    document.getElementById('inputNightMax').value = data.night_max;
                    document.getElementById('inputLedOn').value = data.led_on;
                    document.getElementById('inputLedOff').value = data.led_off;
                    document.getElementById('inputControl').checked = data.control_enabled;
                    document.getElementById('inputForceLed').checked = data.led_force;
                    document.getElementById('inputCycleTime').value = data.cycle_time;
                })
                .catch(error => console.error('Error:', error));
        }

        // è¨­å®šæ›´æ–°ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®å‡¦ç†
        function updateConfig() {
            let newConfig = {
                day_start: document.getElementById('inputDayStart').value,
                day_end: document.getElementById('inputDayEnd').value,
                day_temp_min: parseInt(document.getElementById('inputDayMin').value, 10),
                day_temp_max: parseInt(document.getElementById('inputDayMax').value, 10),
                night_temp_min: parseInt(document.getElementById('inputNightMin').value, 10),
                night_temp_max: parseInt(document.getElementById('inputNightMax').value, 10),
                led_on: document.getElementById('inputLedOn').value,
                led_off: document.getElementById('inputLedOff').value,
                control_enabled: document.getElementById('inputControl').checked,
                led_force: document.getElementById('inputForceLed').checked,
                cycle_time: parseInt(document.getElementById('inputCycleTime').value)
            };
            fetch(URL_API_BASE + '/update_config', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(newConfig)
            })
            .then(response => response.json())
            .then(data => {
                if(data.result === "success") {
                    alert("è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸ");
                    updateStatus();
                } else {
                    alert("è¨­å®šæ›´æ–°ã‚¨ãƒ©ãƒ¼");
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
    <div class="card">
        <h1>ğŸ€Seeding Box</h1>
        <div class="status-row">
            <div class="labeled-value">
                <label>æ¸©åº¦(<span id="tempStatus">--</span>)</label>
                <div class="block-container" id="currentTemp">--</div>
            </div>
            <div class="labeled-value">
                <label>ãƒ’ãƒ¼ã‚¿ãƒ¼</label>
                <div class="block-container" id="heaterStatus">--</div>
            </div>
            <div class="labeled-value">
                <label>LEDç…§æ˜</label>
                <div class="block-container" id="ledStatus">--</div>
            </div>
            <button onclick="updateStatus()">æ›´æ–°</button>
        </div>
        <hr>
        <h2>è¨­å®šå¤‰æ›´</h2>
        <form onsubmit="event.preventDefault(); updateConfig();">
            <!-- åˆ¶å¾¡ON/OFF ã‚¹ã‚¤ãƒƒãƒ -->
            <div class="form-row">
                <div class="form-group">
                    <label>åˆ¶å¾¡ ON/OFF</label>
                    <div class="block-container">
                        <label class="switch">
                            <input type="checkbox" id="inputControl">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="button-group">
                    <button type="submit">ä¿å­˜</button>
                    <button type="button" id="reset-btn" onclick="loadConfigIntoForm()">ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
            </div>
            <!-- æ˜¼é–“æ™‚åˆ» -->
            <div class="form-row">
                <div class="form-group">
                    <label for="inputDayStart">æ˜¼è¨­å®š</label>
                    <input type="time" id="inputDayStart" required> ã‹ã‚‰
                    <label for="inputDayMin">æ¸©åº¦</label>
                    <input type="number" id="inputDayMin" step="1" min="1" max="30" required> ã€œ
                    <input type="number" id="inputDayMax" step="1" min="1" max="30" required> Â°C
                </div>
            </div>
            <!-- æ˜¼é–“æ¸©åº¦ï¼ˆä¸‹é™ã€œä¸Šé™ï¼‰ -->
            <div class="form-row">
                <div class="form-group">
                    <label for="inputDayEnd">å¤œè¨­å®š</label>
                    <input type="time" id="inputDayEnd" required> ã‹ã‚‰
                    <label for="inputNightMin">æ¸©åº¦</label>
                    <input type="number" id="inputNightMin" step="1" min="1" max="30" required> ã€œ
                    <input type="number" id="inputNightMax" step="1" min="1" max="30" required> Â°C
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>LEDç‚¹ç¯æ™‚é–“</label>
                    <input type="time" id="inputLedOn" required>
                    <span>ã€œ</span>
                    <input type="time" id="inputLedOff" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>åˆ¶å¾¡ã‚µã‚¤ã‚¯ãƒ«</label>
                    <input type="number" id="inputCycleTime" step="1" min="1" required> ç§’
                </div>
                <label>LEDå¼·åˆ¶ç‚¹ç¯</label>
                <div class="block-container">
                    <label class="switch">
                        <input type="checkbox" id="inputForceLed">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </form>
    </div>
</body>
</html>

