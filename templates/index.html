<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ËÇ≤ËãóÁÆ± Ê∏©Â∫¶„ÉªLEDÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    <style>
        body {
            background-color: seagreen;
        }
        /* ÂÖ®‰Ωì„Ç´„Éº„Éâ */
        .card {
            background: #f0fff8;
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            width: 90%;
            max-width: 400px;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
            font-family: Arial, sans-serif;
        }
        /* „Çø„Ç§„Éà„É´ */
        .card h1 {
            text-align: center;
            margin: 20px;
            font-size: 1.8rem;
        }
        /* „Çª„ÇØ„Ç∑„Éß„É≥Ë¶ãÂá∫„Åó */
        .card h2 {
            margin: 10px 0px;
            text-align: center;
            font-size: 1.2rem;
        }
        /* „Çπ„ÉÜ„Éº„Çø„ÇπÈÉ®ÂàÜ„ÅÆË°å */
        .status-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
        }
        /* „Çª„ÇØ„Ç∑„Éß„É≥Ë¶ãÂá∫„Åó */
        .card h2 {
            margin: 10px 0px;
            text-align: center;
        }
        /* „Éà„Ç∞„É´„Çπ„Ç§„ÉÉ„ÉÅ CSS */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        .switch input { 
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 23px;
            width: 23px;
            left: 5px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: seagreen;
        }
        input:checked + .slider:before {
            transform: translateX(28px);
        }
        /* „Éï„Ç©„Éº„É†„ÅÆË°å */
        .form-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        /* Âà∂Âæ°„Çπ„Ç§„ÉÉ„ÉÅÂ∞ÇÁî®Ôºà„É©„Éô„É´„ÅØ‰∏äÊÆµ„ÄÅ„Çπ„Ç§„ÉÉ„ÉÅ„ÅØ‰∏ãÊÆµÔºâ */
        .block-container {
            display: block;
            margin-top: 5px;
        }
        .form-group {
            flex: 1;
            margin-right: 10px;
        }
        .form-group:last-child {
            margin-right: 0;
        }
        .labeled-value {
            flex: 1;
            margin-right: 10px;
            text-align: center;
        }
        label {
            margin-bottom: 5px;
        }
        input[type="number"] {
            width: 4em;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ced4da;
        }
        input[type="time"] {
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ced4da;
        }
        /* „Éú„Çø„É≥ */
        button {
            padding: 10px 15px;
            background-color: #2196F3;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        button {
            background: seagreen;
            color: white;
        }
        button:hover {
            background: lightseagreen;
        }
        #reset-btn {
            background: slategray;
            color: white;
        }
        #reset-btn:hover {
            background: silver;
        }
        .button-group {
            display: flex;
            align-items: center;
        }
    </style>
    <script>
        const URL_API_BASE = "http://{{server_ip}}:5000/api";

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´„Çπ„ÉÜ„Éº„Çø„ÇπÂèñÂæó„Å®„Éï„Ç©„Éº„É†„Å∏Ë®≠ÂÆöÂÄ§„ÅÆ„É≠„Éº„Éâ
        window.onload = function() {
            updateStatus();
            loadConfigIntoForm();
        };

        // /status„Åã„ÇâÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶„ÄÅ‰∏äÈÉ®„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç´„Éº„Éâ„Å´ÂèçÊò†
        function updateStatus() {
            fetch(URL_API_BASE + '/status')
                .then(response => response.json())
                .then(data => {
                    // Ê∏©Â∫¶Ë°®Á§∫„Å´ÊòºÂ§úÊÉÖÂ†±„Çí‰ªòÂä†„Åó„ÄÅtemp_status„Å´Âøú„Åò„ÅüËâ≤„ÇíË®≠ÂÆö
                    var tempElem = document.getElementById('currentTemp');
                    tempElem.innerText = data.temperature + " ¬∞C";
                    if (data.temp_status === "low") {
                        tempElem.style.color = "blue";
                    } else if (data.temp_status === "high") {
                        tempElem.style.color = "red";
                    } else {
                        tempElem.style.color = "black";
                    }
                    document.getElementById('tempStatus').innerText = data.time_of_day ? "Êòº" : "Â§ú";
                    document.getElementById('heaterStatus').innerText = data.heater ? "ON" : "OFF";
                    document.getElementById('ledStatus').innerText = data.led ? "ON" : "OFF";
                })
                .catch(error => console.error('Error:', error));
        }

        // /status„Åã„ÇâÂèñÂæó„Åó„ÅüË®≠ÂÆöÂÄ§„ÇíË®≠ÂÆö„Éï„Ç©„Éº„É†„Å´ÂèçÊò†
        function loadConfigIntoForm() {
            fetch(URL_API_BASE + '/status')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('inputDayStart').value = data.day_start;
                    document.getElementById('inputDayEnd').value = data.day_end;
                    document.getElementById('inputDayMin').value = data.day_min;
                    document.getElementById('inputDayMax').value = data.day_max;
                    document.getElementById('inputNightMin').value = data.night_min;
                    document.getElementById('inputNightMax').value = data.night_max;
                    document.getElementById('inputLedOn').value = data.led_on;
                    document.getElementById('inputLedOff').value = data.led_off;
                    document.getElementById('inputControl').checked = data.control_enabled;
                    document.getElementById('inputForceLed').checked = data.led_force;
                    document.getElementById('inputCycleTime').value = data.cycle_time;
                })
                .catch(error => console.error('Error:', error));
        }

        // Ë®≠ÂÆöÊõ¥Êñ∞„Éï„Ç©„Éº„É†ÈÄÅ‰ø°ÊôÇ„ÅÆÂá¶ÁêÜ
        function updateConfig() {
            let newConfig = {
                day_start: document.getElementById('inputDayStart').value,
                day_end: document.getElementById('inputDayEnd').value,
                day_temp_min: parseInt(document.getElementById('inputDayMin').value, 10),
                day_temp_max: parseInt(document.getElementById('inputDayMax').value, 10),
                night_temp_min: parseInt(document.getElementById('inputNightMin').value, 10),
                night_temp_max: parseInt(document.getElementById('inputNightMax').value, 10),
                led_on: document.getElementById('inputLedOn').value,
                led_off: document.getElementById('inputLedOff').value,
                control_enabled: document.getElementById('inputControl').checked,
                led_force: document.getElementById('inputForceLed').checked,
                cycle_time: parseInt(document.getElementById('inputCycleTime').value)
            };
            fetch(URL_API_BASE + '/update_config', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(newConfig)
            })
            .then(response => response.json())
            .then(data => {
                if(data.result === "success") {
                    alert("Ë®≠ÂÆö„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü");
                    updateStatus();
                } else {
                    alert("Ë®≠ÂÆöÊõ¥Êñ∞„Ç®„É©„Éº");
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
    <div class="card">
        <h1>üçÄSeeding Box</h1>
        <div class="status-row">
            <div class="labeled-value">
                <label>Ê∏©Â∫¶(<span id="tempStatus">--</span>)</label>
                <div class="block-container" id="currentTemp">--</div>
            </div>
            <div class="labeled-value">
                <label>„Éí„Éº„Çø„Éº</label>
                <div class="block-container" id="heaterStatus">--</div>
            </div>
            <div class="labeled-value">
                <label>LEDÁÖßÊòé</label>
                <div class="block-container" id="ledStatus">--</div>
            </div>
            <button onclick="updateStatus()">Êõ¥Êñ∞</button>
        </div>
        <hr>
        <h2>Ë®≠ÂÆöÂ§âÊõ¥</h2>
        <form onsubmit="event.preventDefault(); updateConfig();">
            <!-- Âà∂Âæ°ON/OFF „Çπ„Ç§„ÉÉ„ÉÅ -->
            <div class="form-row">
                <div class="form-group">
                    <label>Âà∂Âæ° ON/OFF</label>
                    <div class="block-container">
                        <label class="switch">
                            <input type="checkbox" id="inputControl">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="button-group">
                    <button type="submit">‰øùÂ≠ò</button>
                    <button type="button" id="reset-btn" onclick="loadConfigIntoForm()">„É™„Çª„ÉÉ„Éà</button>
                </div>
            </div>
            <!-- ÊòºÈñìÊôÇÂàª -->
            <div class="form-row">
                <div class="form-group">
                    <label for="inputDayStart">ÊòºË®≠ÂÆö</label>
                    <input type="time" id="inputDayStart" required> „Åã„Çâ
                    <label for="inputDayMin">Ê∏©Â∫¶</label>
                    <input type="number" id="inputDayMin" step="1" min="1" max="30" required> „Äú
                    <input type="number" id="inputDayMax" step="1" min="1" max="30" required> ¬∞C
                </div>
            </div>
            <!-- ÊòºÈñìÊ∏©Â∫¶Ôºà‰∏ãÈôê„Äú‰∏äÈôêÔºâ -->
            <div class="form-row">
                <div class="form-group">
                    <label for="inputDayEnd">Â§úË®≠ÂÆö</label>
                    <input type="time" id="inputDayEnd" required> „Åã„Çâ
                    <label for="inputNightMin">Ê∏©Â∫¶</label>
                    <input type="number" id="inputNightMin" step="1" min="1" max="30" required> „Äú
                    <input type="number" id="inputNightMax" step="1" min="1" max="30" required> ¬∞C
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>LEDÁÇπÁÅØÊôÇÈñì</label>
                    <input type="time" id="inputLedOn" required>
                    <span>„Äú</span>
                    <input type="time" id="inputLedOff" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Âà∂Âæ°„Çµ„Ç§„ÇØ„É´</label>
                    <input type="number" id="inputCycleTime" step="1" min="1" required> Áßí
                </div>
                <label>LEDÂº∑Âà∂ÁÇπÁÅØ</label>
                <div class="block-container">
                    <label class="switch">
                        <input type="checkbox" id="inputForceLed">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </form>
    </div>
</body>
</html>

